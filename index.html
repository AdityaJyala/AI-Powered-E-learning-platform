<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IntelliLearn AI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Global Styles & Resets */
        :root {
            --indigo-50: #eef2ff; --indigo-100: #e0e7ff; --indigo-200: #c7d2fe; --indigo-400: #818cf8; --indigo-500: #6366f1; --indigo-600: #4f46e5; --indigo-700: #4338ca;
            --gray-50: #f9fafb; --gray-100: #f3f4f6; --gray-200: #e5e7eb; --gray-300: #d1d5db; --gray-400: #9ca3af; --gray-500: #6b7280; --gray-600: #4b5563; --gray-700: #374151; --gray-800: #1f2937;
            --slate-50: #f8fafc; --slate-100: #f1f5f9; --slate-200: #e2e8f0;
            --red-50: #fef2f2; --red-100: #fee2e2; --red-500: #ef4444; --red-700: #b91c1c; --red-800: #991b1b;
            --green-50: #f0fdf4; --green-100: #dcfce7; --green-500: #22c55e; --green-600: #16a34a; --green-700: #15803d; --green-800: #166534;
            --yellow-50: #fefce8; --yellow-100: #fef9c3; --yellow-400: #facc15; --yellow-500: #eab308; --yellow-800: #854d0e; --yellow-900: #713f12;
            --blue-100: #dbeafe; --blue-500: #3b82f6; --blue-600: #2563eb; --blue-800: #1e40af;
            --orange-400: #fb923c; --orange-500: #f97316;
            --purple-500: #a855f7; --purple-600: #9333ea; --purple-700: #7e22ce;
            --fuchsia-600: #d946ef; --fuchsia-700: #c026d3;
            --teal-600: #0d9488; --teal-700: #0f766e;
            --cyan-500: #06b6d4;
        }
        
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
            background-color: var(--slate-50);
            color: var(--gray-800);
            line-height: 1.5;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .container {
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        @media (min-width: 640px) { .container { max-width: 640px; padding-left: 1.5rem; padding-right: 1.5rem;} }
        @media (min-width: 768px) { .container { max-width: 768px;} }
        @media (min-width: 1024px) { .container { max-width: 1024px; padding-left: 2rem; padding-right: 2rem;} }
        @media (min-width: 1280px) { .container { max-width: 1280px;} }

        /* Animation */
        @keyframes fade-in { 0% { opacity: 0; } 100% { opacity: 1; } }
        @keyframes fade-in-up { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 50% { opacity: .5; } }
        @keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); } 50% { transform: translateY(0); animation-timing-function: cubic-bezier(0,0,0.2,1); } }
        
        .animate-fade-in { animation: fade-in 0.3s ease-out; }
        .animate-fade-in-up { animation: fade-in-up 0.4s ease-out; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-bounce { animation: bounce 1s infinite; }

        /* Main Screen Layout */
        .screen-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        /* Card and Box Styles */
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            padding: 2rem;
            width: 100%;
            max-width: 28rem;
            border: 1px solid var(--gray-200);
            z-index: 10;
        }

        /* Button Styles */
        .btn {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn-primary {
            background-color: var(--indigo-600);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--indigo-700);
            transform: scale(1.05);
        }
        .btn:disabled {
            background-color: var(--gray-300);
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background-color: var(--gray-200);
            color: var(--gray-800);
        }
        .btn-secondary:hover {
            background-color: var(--gray-300);
        }
        .btn-smart-review {
            background-color: var(--purple-600);
            color: white;
        }
        .btn-smart-review:hover {
            background-color: var(--purple-700);
        }

        /* Form Styles */
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--indigo-500);
            box-shadow: 0 0 0 2px var(--indigo-100);
        }
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }

        /* Login & Signup Screen */
        #login-screen, #signup-screen {
            background-color: var(--gray-100);
        }
        .auth-container .icon-wrapper {
            display: inline-block;
            background-color: var(--indigo-500);
            padding: 1rem;
            border-radius: 9999px;
            margin-bottom: 1rem;
        }
        .auth-container .icon-wrapper svg { color: white; width: 3rem; height: 3rem; }
        .auth-container h1 {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--gray-800);
            letter-spacing: -0.025em;
            margin: 0 0 0.5rem 0;
        }
        .auth-container p {
            color: var(--gray-600);
            margin-top: 0;
        }
        .auth-container .link {
            color: var(--indigo-600);
            font-weight: 500;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
        }
        .auth-container .link:hover { text-decoration: underline; }
        .auth-container .demo-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: var(--indigo-50);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            color: var(--indigo-700);
        }
        .error-message {
            color: var(--red-500);
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        .error-message svg { margin-right: 0.5rem; width: 1rem; height: 1rem;}

        /* Dashboard Screen */
        .header {
            background-color: white;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 20;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }
        .header .logo { display: flex; align-items: center; gap: 0.75rem; }
        .header .logo h1 { font-size: 1.5rem; font-weight: 700; margin: 0;}
        .header .user-menu { display: flex; align-items: center; gap: 1rem; }
        .header .user-menu .profile-img {
            width: 2rem;
            height: 2rem;
            border-radius: 9999px;
            object-fit: cover;
            border: 2px solid var(--indigo-200);
        }
        .header .user-menu button { background: none; border: none; padding: 0.5rem; cursor: pointer; border-radius: 9999px; }
        .header .user-menu button:hover { background-color: var(--gray-100); }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        @media (min-width: 1024px) {
            .dashboard-grid { grid-template-columns: 2fr 1fr; }
        }
        .subject-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 640px) { .subject-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { .subject-grid { grid-template-columns: repeat(3, 1fr); } }
        
        .subject-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
        }
        .subject-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .subject-card .card-header { display: flex; align-items: center; margin-bottom: 1rem; }
        .subject-card .card-header h2 { font-size: 1.25rem; font-weight: 700; margin: 0;}
        .subject-card .card-header svg { margin-right: 1rem; width: 2rem; height: 2rem; }
        .subject-card .progress-bar-bg { width: 100%; background-color: var(--gray-200); border-radius: 9999px; height: 0.625rem; }
        .subject-card .progress-bar-fg { background-image: linear-gradient(to right, var(--blue-500), var(--indigo-500)); height: 100%; border-radius: 9999px; }
        .subject-card .start-btn { margin-top: auto; }

        /* Performance Analysis & Charts */
        .analysis-container {
             background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            padding: 1.5rem;
            margin-top: 2.5rem;
        }
        .analysis-section {
            margin-top: 2.5rem;
            padding-top: 2.5rem;
            border-top: 1px solid var(--gray-200);
        }
        .analysis-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .improvement-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .improvement-item {
            background-color: var(--red-50);
            border-left: 4px solid var(--red-500);
            padding: 0.75rem 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        .improvement-item span { font-weight: 500; }
        .improvement-item button {
            background-color: var(--blue-100);
            color: var(--blue-800);
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            width: auto;
            flex-shrink: 0;
        }
        .improvement-item button:hover { background-color: #bfdbfe; }
        
        /* Quiz Screen */
        .quiz-card { max-width: 48rem; }
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .quiz-header h2 { font-size: 1.25rem; font-weight: 700; margin: 0; text-transform: capitalize; }
        .quiz-question-text {
            font-size: 1.25rem;
            font-weight: 600;
            text-align: center;
            min-height: 60px;
            margin-bottom: 2rem;
        }
        .quiz-options { display: flex; flex-direction: column; gap: 1rem; }
        .quiz-option-btn {
            width: 100%;
            text-align: left;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid var(--slate-200);
            background-color: var(--slate-50);
            transition: all 0.2s;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .quiz-option-btn:hover { border-color: var(--indigo-400); }
        .quiz-option-btn.selected {
            background-color: var(--indigo-500);
            border-color: var(--indigo-500);
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .submit-btn {
            background-color: var(--green-500);
            margin-top: 2rem;
        }
        .submit-btn:hover { background-color: var(--green-600); }

        /* Quiz Results Screen */
        .results-card .icon-wrapper {
            display: inline-block;
            background-color: var(--yellow-100);
            padding: 1rem;
            border-radius: 9999px;
            margin-bottom: 1rem;
        }
        .results-card .icon-wrapper svg { color: var(--yellow-400); width: 4rem; height: 4rem; }
        .results-card h1 { font-size: 2.25rem; font-weight: 700; margin: 0; }
        .results-card .score-text { font-size: 1.25rem; color: var(--gray-600); }
        .results-card .score-text b { color: var(--indigo-600); }
        .review-question {
            background-color: var(--red-50);
            border-left: 4px solid var(--red-500);
            padding: 1rem;
            border-radius: 0 0.5rem 0.5rem 0;
            margin-bottom: 1rem;
        }
        .review-question button {
            background-color: var(--blue-100);
            color: var(--blue-800);
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            width: auto;
            margin-top: 0.75rem;
        }
        
        /* Profile Screen */
        #profile-screen .card { max-width: 42rem; }
        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        @media (min-width: 640px) {
            .profile-header { flex-direction: row; gap: 1.5rem; }
        }
        .profile-header img {
            width: 8rem;
            height: 8rem;
            border-radius: 9999px;
            object-fit: cover;
            border: 4px solid var(--indigo-200);
        }

        /* AI Mentor Modal Styles */
        #ai-mentor-modal {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mentor-chat-window {
            background-color: white;
            width: 100%;
            max-width: 42rem;
            height: 80vh;
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            display: flex;
            flex-direction: column;
        }
        .mentor-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .mentor-header h2 { margin: 0; font-size: 1.25rem; }
        .mentor-header h2 span { color: var(--blue-600); }
        .mentor-header button { background: none; border: none; cursor: pointer; padding: 0.5rem; }
        .mentor-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .message {
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            max-width: 80%;
            line-height: 1.6;
            word-wrap: break-word;
        }
        .message.user {
            background-color: var(--blue-500);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }
        .message.ai {
            background-color: var(--gray-200);
            color: var(--gray-800);
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }
        .message.ai b, .message.ai strong { color: var(--gray-900); }
        .message.ai code { background-color: var(--gray-300); padding: 0.1rem 0.3rem; border-radius: 0.25rem; font-family: monospace; }
        .mentor-input-form {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 0.5rem;
        }
    </style>
</head>
<body>

    <div id="app-root"></div>
    <div id="ai-mentor-modal" class="hidden"></div>

    <script>
        // --- IMPORTANT: ADD YOUR API KEY HERE ---
        const GEMINI_API_KEY = "AIzaSyAzkNMcetBB7y4NuIr9FKG7-iTayROn-Uc"; 

        // --- ICONS (as SVG strings) ---
        const icons = {
            Brain: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.94-3.43 2.5 2.5 0 0 1 .33-4.25 2.5 2.5 0 0 1 2.4-3.35 2.5 2.5 0 0 1 2.43-2.8z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.94-3.43 2.5 2.5 0 0 0-.33-4.25 2.5 2.5 0 0 0-2.4-3.35 2.5 2.5 0 0 0-2.43-2.8z"/></svg>`,
            BookOpen: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
            Code: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>`,
            Network: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="16" y="16" width="6" height="6" rx="1"/><rect x="2" y="16" width="6" height="6" rx="1"/><rect x="9" y="2" width="6" height="6" rx="1"/><path d="M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3"/><path d="M12 12V8"/></svg>`,
            Cpu: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><path d="M15 2v2"/><path d="M15 20v2"/><path d="M2 15h2"/><path d="M2 9h2"/><path d="M20 15h2"/><path d="M20 9h2"/><path d="M9 2v2"/><path d="M9 20v2"/></svg>`,
            Database: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>`,
            Briefcase: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>`,
            Trophy: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C17.15 18.75 18 20.24 18 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>`,
            LogOut: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>`,
            CheckCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
            ArrowLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>`,
            RefreshCw: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>`,
            AlertCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
            TrendingUp: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>`,
            X: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`,
            Send: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>`,
            Zap: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>`
        };

        // --- SIMULATED DATABASE & QUESTIONS ---
        const DB = { users: [], progress: [], attempts: [] };
        
        const QUESTION_BANK = {
             grammar: [
                { id: 1, q: "Choose the correct form: 'She ___ to the store yesterday.'", options: ["go", "goes", "went", "going"], answer: 2, difficulty: "easy", topic: "Past Tense" },
                { id: 2, q: "Identify the error: 'He don't like pizza.'", options: ["don't", "like", "pizza", "No error"], answer: 0, difficulty: "easy", topic: "Subject-Verb Agreement" },
                { id: 3, q: "Which is correct? 'Neither of the boys ___ present.'", options: ["is", "are", "were", "be"], answer: 0, difficulty: "medium", topic: "Subject-Verb Agreement" },
                { id: 4, q: "What type of clause: 'Although it was raining, we went out.'", options: ["Noun clause", "Adjective clause", "Adverb clause", "Independent clause"], answer: 2, difficulty: "medium", topic: "Clauses" },
                { id: 5, q: "Choose correct: 'I have ___ finished my homework.'", options: ["yet", "already", "still", "always"], answer: 1, difficulty: "easy", topic: "Adverbs" },
                { id: 6, q: "Passive voice of 'They are building a house': ", options: ["A house is being built by them", "A house is built by them", "A house was being built", "A house has been built"], answer: 0, difficulty: "hard", topic: "Passive Voice" },
                { id: 7, q: "Which sentence uses 'whom' correctly?", options: ["Whom is calling?", "To whom did you speak?", "Whom called you?", "Whom are you?"], answer: 1, difficulty: "hard", topic: "Pronouns" },
                { id: 8, q: "Identify the gerund: 'Swimming is good exercise.'", options: ["Swimming", "is", "good", "exercise"], answer: 0, difficulty: "medium", topic: "Gerunds" },
                { id: 9, q: "Correct form: 'If I ___ rich, I would travel the world.'", options: ["am", "was", "were", "be"], answer: 2, difficulty: "medium", topic: "Conditionals" },
                { id: 10, q: "What is the superlative of 'bad'?", options: ["badder", "baddest", "worse", "worst"], answer: 3, difficulty: "easy", topic: "Comparatives" },
                { id: 11, q: "Choose correct: 'Between you and ___'", options: ["I", "me", "myself", "mine"], answer: 1, difficulty: "medium", topic: "Pronouns" },
                { id: 12, q: "Which is a coordinating conjunction?", options: ["although", "because", "but", "since"], answer: 2, difficulty: "easy", topic: "Conjunctions" },
                { id: 13, q: "Identify the participle: 'The broken window needs repair.'", options: ["The", "broken", "window", "needs"], answer: 1, difficulty: "medium", topic: "Participles" },
                { id: 14, q: "Which uses subjunctive mood correctly?", options: ["I wish I was rich", "I wish I were rich", "I wish I am rich", "I wish I be rich"], answer: 1, difficulty: "hard", topic: "Subjunctive Mood" },
                { id: 15, q: "What is the plural of 'criterion'?", options: ["criterions", "criteria", "criterias", "criteriae"], answer: 1, difficulty: "hard", topic: "Plurals" },
                { id: 16, q: "Add a comma: 'Let's eat Grandma.'", options: ["Let's eat, Grandma.", "Let's, eat Grandma.", "Let's eat Grandma,", "No comma needed"], answer: 0, difficulty: "easy", topic: "Punctuation" },
                { id: 17, q: "Which is an idiom? 'He is a night owl.'", options: ["A type of bird", "Someone who stays up late", "A wise person", "Someone who is lost"], answer: 1, difficulty: "medium", topic: "Idioms" },
                { id: 18, q: "My sister's friend's dog is cute. Where is the apostrophe error?", options: ["sister's", "friend's", "No error", "Both are wrong"], answer: 2, difficulty: "medium", topic: "Punctuation" },
                { id: 19, q: "The book, ___ I read last week, was amazing.", options: ["that", "which", "who", "whom"], answer: 1, difficulty: "hard", topic: "Clauses" },
                { id: 20, q: "He runs ___ than his brother.", options: ["fast", "faster", "fastest", "more fast"], answer: 1, difficulty: "easy", topic: "Comparatives" },
                { id: 21, q: "Identify the adverb: 'She sings beautifully.'", options: ["She", "sings", "beautifully", "No adverb"], answer: 2, difficulty: "easy", topic: "Adverbs" },
                { id: 22, q: "'To boldly go where no one has gone before' contains what?", options: ["A dangling modifier", "A split infinitive", "A run-on sentence", "A comma splice"], answer: 1, difficulty: "hard", topic: "Advanced Grammar" },
                { id: 23, q: "The team ___ ready for the game.", options: ["is", "are", "be", "was"], answer: 0, difficulty: "medium", topic: "Subject-Verb Agreement" },
                { id: 24, q: "Affect vs. Effect: 'The rain will ___ our plans.'", options: ["affect", "effect", "affects", "effects"], answer: 0, difficulty: "medium", topic: "Commonly Confused Words" },
                { id: 25, q: "It's vs. Its: 'The dog wagged ___ tail.'", options: ["it's", "its", "its'", "it is"], answer: 1, difficulty: "easy", topic: "Commonly Confused Words" }
            ],
            dsa: [
                { id: 1, q: "What is the time complexity of binary search?", options: ["O(n)", "O(log n)", "O(n²)", "O(1)"], answer: 1, difficulty: "easy", topic: "Search Algorithms" },
                { id: 2, q: "Which data structure uses LIFO?", options: ["Queue", "Stack", "Tree", "Graph"], answer: 1, difficulty: "easy", topic: "Stacks & Queues" },
                { id: 3, q: "Best case time complexity of Quick Sort?", options: ["O(n log n)", "O(n²)", "O(n)", "O(log n)"], answer: 0, difficulty: "medium", topic: "Sorting Algorithms" },
                { id: 4, q: "In a max heap, where is the largest element?", options: ["Leaf node", "Root node", "Middle", "Random"], answer: 1, difficulty: "easy", topic: "Heaps" },
                { id: 5, q: "What does BFS use for traversal?", options: ["Stack", "Queue", "Array", "Tree"], answer: 1, difficulty: "medium", topic: "Graph Traversal" },
                { id: 6, q: "Time complexity of inserting at end of a dynamic array?", options: ["O(1) amortized", "O(n)", "O(log n)", "O(n²)"], answer: 0, difficulty: "easy", topic: "Arrays" },
                { id: 7, q: "Which algorithm finds shortest path in a weighted graph?", options: ["DFS", "BFS", "Dijkstra's", "Prim's"], answer: 2, difficulty: "medium", topic: "Graph Algorithms" },
                { id: 8, q: "Worst case time complexity of merge sort?", options: ["O(n)", "O(n log n)", "O(n²)", "O(log n)"], answer: 1, difficulty: "medium", topic: "Sorting Algorithms" },
                { id: 9, q: "What defines a balanced binary search tree (like AVL)?", options: ["All nodes are equal", "Height difference of subtrees is at most 1", "All leaves are at the same level", "It has a random structure"], answer: 1, difficulty: "hard", topic: "Trees" },
                { id: 10, q: "Space complexity of a recursive fibonacci implementation?", options: ["O(1)", "O(n)", "O(log n)", "O(n²)"], answer: 1, difficulty: "medium", topic: "Recursion" },
                { id: 11, q: "Which is a 'divide and conquer' algorithm?", options: ["Bubble Sort", "Insertion Sort", "Merge Sort", "Selection Sort"], answer: 2, difficulty: "medium", topic: "Algorithm Paradigms" },
                { id: 12, q: "What is the height of a complete binary tree with n nodes?", options: ["O(log n)", "O(n)", "O(n²)", "O(√n)"], answer: 0, difficulty: "hard", topic: "Trees" },
                { id: 13, q: "Average time complexity to find an element in a hash table?", options: ["O(1)", "O(n)", "O(log n)", "O(n²)"], answer: 0, difficulty: "easy", topic: "Hashing" },
                { id: 14, q: "Topological sort is used on which type of graph?", options: ["Undirected graphs", "Directed Acyclic Graphs (DAGs)", "Complete graphs", "Bipartite graphs"], answer: 1, difficulty: "hard", topic: "Graph Algorithms" },
                { id: 15, q: "Which data structure is best for an LRU cache?", options: ["Array", "Stack", "HashMap + Doubly Linked List", "Queue"], answer: 2, difficulty: "hard", topic: "System Design" },
                { id: 16, q: "Which of these is a greedy algorithm?", options: ["Merge Sort", "Kruskal's Algorithm", "BFS", "DFS"], answer: 1, difficulty: "medium", topic: "Algorithm Paradigms" },
                { id: 17, q: "What is memoization a form of?", options: ["Greedy Algorithms", "Dynamic Programming", "Divide and Conquer", "Backtracking"], answer: 1, difficulty: "medium", topic: "Dynamic Programming" },
                { id: 18, q: "A data structure for efficient prefix searches is:", options: ["Queue", "BST", "Trie", "Heap"], answer: 2, difficulty: "hard", topic: "Tries" },
                { id: 19, q: "Which data structure uses FIFO?", options: ["Stack", "Queue", "Array", "Linked List"], answer: 1, difficulty: "easy", topic: "Stacks & Queues" },
                { id: 20, q: "The number of edges in a complete graph with N vertices is:", options: ["N-1", "N*(N-1)/2", "N*N", "2N"], answer: 1, difficulty: "hard", topic: "Graph Theory" },
                { id: 21, q: "What is the main purpose of a linked list?", options: ["Fast random access", "Dynamic size and efficient insertion/deletion", "Sorting large datasets", "Storing key-value pairs"], answer: 1, difficulty: "easy", topic: "Linked Lists" },
                { id: 22, q: "Which sorting algorithm has a worst-case time complexity of O(n²)?", options: ["Merge Sort", "Heap Sort", "Quick Sort", "Tim Sort"], answer: 2, difficulty: "medium", topic: "Sorting Algorithms" },
                { id: 23, q: "Pre-order traversal of a BST is:", options: ["Left, Root, Right", "Left, Right, Root", "Root, Left, Right", "Root, Right, Left"], answer: 2, difficulty: "medium", topic: "Trees" },
                { id: 24, q: "A collision in a hash table occurs when:", options: ["Two keys are the same", "Two different keys map to the same index", "The hash table is full", "A key is not found"], answer: 1, difficulty: "easy", topic: "Hashing" },
                { id: 25, q: "Dijkstra's algorithm may not work correctly with:", options: ["Weighted edges", "Directed graphs", "Negative weight edges", "Cyclic graphs"], answer: 2, difficulty: "hard", topic: "Graph Algorithms" }
            ],
            programming: [
                { id: 1, q: "What does 'const' mean in JavaScript?", options: ["Variable", "Constant reference", "Function", "Class"], answer: 1, difficulty: "easy", topic: "Variables" },
                { id: 2, q: "Which is not a primitive type in JS?", options: ["string", "number", "object", "boolean"], answer: 2, difficulty: "easy", topic: "Data Types" },
                { id: 3, q: "What does '===' check in JavaScript?", options: ["Value only", "Type only", "Value and type", "Neither"], answer: 2, difficulty: "medium", topic: "Operators" },
                { id: 4, q: "What is a closure in JavaScript?", options: ["A function with access to its outer scope", "A loop structure", "A class method", "A variable scope"], answer: 0, difficulty: "medium", topic: "Closures" },
                { id: 5, q: "Which method adds an element to the end of an array?", options: ["push()", "pop()", "shift()", "unshift()"], answer: 0, difficulty: "easy", topic: "Arrays" },
                { id: 6, q: "What is the output of `typeof null` in JS?", options: ["null", "undefined", "object", "number"], answer: 2, difficulty: "hard", topic: "Types" },
                { id: 7, q: "What does an `async` function always return?", options: ["A callback", "A Promise", "A value", "An error"], answer: 1, difficulty: "medium", topic: "Async/Await" },
                { id: 8, q: "Which is NOT a standard loop in JavaScript?", options: ["for", "while", "repeat...until", "do...while"], answer: 2, difficulty: "easy", topic: "Loops" },
                { id: 9, q: "What is hoisting in JavaScript?", options: ["Moving declarations to the top of their scope", "Lifting heavy objects", "Sorting arrays", "Creating functions"], answer: 0, difficulty: "medium", topic: "Execution Context" },
                { id: 10, q: "What does 'this' refer to in an arrow function?", options: ["The calling object", "The lexical scope's `this`", "The global object", "It's undefined"], answer: 1, difficulty: "hard", topic: "Functions" },
                { id: 11, q: "Which is the correct way to create an object literal?", options: ["let obj = {}", "let obj = []", "let obj = ()", "let obj = <>"], answer: 0, difficulty: "easy", topic: "Objects" },
                { id: 12, q: "What is the purpose of 'use strict'?", options: ["To make code faster", "To enforce stricter parsing and error handling", "To improve UI", "To use more memory"], answer: 1, difficulty: "medium", topic: "Best Practices" },
                { id: 13, q: "What does `Promise.all()` do?", options: ["Runs one promise", "Runs promises in parallel and resolves when all resolve", "Runs promises sequentially", "Creates promises"], answer: 1, difficulty: "medium", topic: "Promises" },
                { id: 14, q: "What is a key difference between `let` and `var`?", options: ["No difference", "`let` is block-scoped, `var` is function-scoped", "Type difference", "`let` is faster"], answer: 1, difficulty: "medium", topic: "Variables" },
                { id: 15, q: "What is event bubbling?", options: ["Creating custom events", "Event propagation from child to parent elements", "Deleting events", "Styling events"], answer: 1, difficulty: "hard", topic: "DOM Events" },
                { id: 16, q: "Which hook is used for managing component side effects in React?", options: ["useState", "useEffect", "useContext", "useReducer"], answer: 1, difficulty: "easy", topic: "React" },
                { id: 17, q: "What does API stand for?", options: ["Application Programming Interface", "Advanced Program Interaction", "Apple Pie Initiative", "Automated Process Integration"], answer: 0, difficulty: "easy", topic: "Web Concepts" },
                { id: 18, q: "A pure function will always return the same output for the same input. True or False?", options: ["True", "False"], answer: 0, difficulty: "medium", topic: "Functional Programming" },
                { id: 19, q: "Which HTTP method is idempotent and used to retrieve data?", options: ["POST", "GET", "DELETE", "PATCH"], answer: 1, difficulty: "easy", topic: "Web Concepts" },
                { id: 20, q: "What is JSX?", options: ["A new language", "A syntax extension for JavaScript", "A data fetching library", "A state management tool"], answer: 1, difficulty: "medium", topic: "React" },
                { id: 21, q: "What does the `...` spread operator do in JavaScript?", options: ["Multiplies numbers", "Expands an iterable into individual elements", "Creates a comment", "Selects all files"], answer: 1, difficulty: "easy", topic: "Operators" },
                { id: 22, q: "In CSS, how do you select an element with id 'header'?", options: [".header", "#header", "header", "*header"], answer: 1, difficulty: "easy", topic: "CSS" },
                { id: 23, q: "What is the 'box model' in CSS?", options: ["A 3D modeling tool", "A model for laying out web pages", "Content, Padding, Border, Margin", "A type of font"], answer: 2, difficulty: "medium", topic: "CSS" },
                { id: 24, q: "What is the `map` function used for on arrays?", options: ["To filter elements", "To check if any element passes a test", "To create a new array by calling a function on every element", "To reduce the array to a single value"], answer: 2, difficulty: "medium", topic: "Arrays" },
                { id: 25, q: "What is a 'callback function'?", options: ["A function that calls itself", "A function passed as an argument to another function", "A built-in JS function", "A function that returns another function"], answer: 1, difficulty: "medium", topic: "Functions" },
                { id: 26, q: "What will this pseudocode output? `x = 5; y = 10; x = y; y = x; PRINT y`", options: ["5", "10", "Error", "0"], answer: 1, difficulty: "easy", topic: "Pseudocode" },
                { id: 27, q: "Trace this pseudocode: `sum = 0; FOR i = 1 to 3; sum = sum + i; ENDFOR; PRINT sum`", options: ["3", "5", "6", "10"], answer: 2, difficulty: "easy", topic: "Pseudocode" },
                { id: 28, q: "What does this pseudocode algorithm do? `FUNCTION find(arr, target); FOR each item in arr; IF item == target; RETURN TRUE; ENDIF; ENDFOR; RETURN FALSE; ENDFUNCTION`", options: ["Sorts the array", "Finds the max value", "Performs a linear search", "Performs a binary search"], answer: 2, difficulty: "medium", topic: "Pseudocode" },
                { id: 29, q: "Identify the logical error: `count = 5; WHILE count > 0; PRINT count; ENDWHILE`", options: ["Syntax error", "Infinite loop", "Off-by-one error", "No error"], answer: 1, difficulty: "medium", topic: "Pseudocode" },
                { id: 30, q: "What is the time complexity of a nested loop `FOR i=1 to n; FOR j=1 to n; ... ENDFOR; ENDFOR`?", options: ["O(n)", "O(log n)", "O(n²)", "O(1)"], answer: 2, difficulty: "hard", topic: "Pseudocode" }
            ],
            computerNetworks: [
                { id: 1, q: "Which layer of the OSI model is responsible for routing?", options: ["Data Link", "Transport", "Network", "Physical"], answer: 2, difficulty: "easy", topic: "OSI Model" },
                { id: 2, q: "What does TCP stand for?", options: ["Transmission Control Protocol", "Total Connection Protocol", "Transfer Control Protocol", "Transport Connection Protocol"], answer: 0, difficulty: "easy", topic: "Protocols" },
                { id: 3, q: "Which protocol is connectionless and faster?", options: ["TCP", "UDP", "HTTP", "FTP"], answer: 1, difficulty: "medium", topic: "Protocols" },
                { id: 4, q: "What is the function of DNS?", options: ["Transfer files", "Route packets", "Translate domain names to IP addresses", "Send emails"], answer: 2, difficulty: "easy", topic: "Core Services" },
                { id: 5, q: "Which of the following is a private IP address?", options: ["127.0.0.1", "8.8.8.8", "192.168.1.1", "204.79.197.200"], answer: 2, difficulty: "medium", topic: "IP Addressing" },
                { id: 6, q: "The physical address of a network device is called:", options: ["IP Address", "Subnet Mask", "MAC Address", "Port Number"], answer: 2, difficulty: "easy", topic: "OSI Model" },
                { id: 7, q: "HTTPS runs on which port by default?", options: ["21", "25", "80", "443"], answer: 3, difficulty: "easy", topic: "Protocols" },
                { id: 8, q: "What is the purpose of a subnet mask?", options: ["To hide the IP address", "To identify the network and host portions of an IP", "To find the MAC address", "To encrypt data"], answer: 1, difficulty: "medium", topic: "IP Addressing" },
                { id: 9, q: "The process of establishing a TCP connection is the:", options: ["One-way handshake", "Two-way handshake", "Three-way handshake", "Four-way handshake"], answer: 2, difficulty: "hard", topic: "Protocols" },
                { id: 10, q: "Which device operates at the Network Layer (Layer 3)?", options: ["Hub", "Switch", "Bridge", "Router"], answer: 3, difficulty: "medium", topic: "Networking Devices" },
                { id: 11, q: "What does APIPA stand for?", options: ["Automatic Private IP Addressing", "Advanced Packet Information Protocol", "Automatic Protocol Internet Addressing", "Advanced Private Internet Protocol"], answer: 0, difficulty: "hard", topic: "IP Addressing" },
                { id: 12, q: "Which layer handles encryption and data compression?", options: ["Application", "Presentation", "Session", "Transport"], answer: 1, difficulty: "medium", topic: "OSI Model" },
                { id: 13, q: "Which protocol is used by the `ping` command?", options: ["TCP", "UDP", "ICMP", "ARP"], answer: 2, difficulty: "medium", topic: "Protocols" },
                { id: 14, q: "What does NAT (Network Address Translation) do?", options: ["Translates private IPs to a public IP", "Assigns MAC addresses", "A routing protocol", "An encryption standard"], answer: 0, difficulty: "easy", topic: "Networking Concepts" },
                { id: 15, q: "A switch primarily operates at which OSI layer?", options: ["Physical", "Data Link", "Network", "Transport"], answer: 1, difficulty: "easy", topic: "Networking Devices" },
                { id: 16, q: "Which class of IP address is 200.20.2.1?", options: ["Class A", "Class B", "Class C", "Class D"], answer: 2, difficulty: "medium", topic: "IP Addressing" },
                { id: 17, q: "What is the loopback IP address?", options: ["192.168.0.1", "10.0.0.1", "127.0.0.1", "255.255.255.255"], answer: 2, difficulty: "easy", topic: "IP Addressing" },
                { id: 18, q: "What is the function of ARP?", options: ["Routes packets", "Resolves IP addresses to MAC addresses", "Provides hostnames", "Transfers files"], answer: 1, difficulty: "medium", topic: "Protocols" },
                { id: 19, q: "Which topology requires a central controller or hub?", options: ["Bus", "Ring", "Star", "Mesh"], answer: 2, difficulty: "easy", topic: "Network Topologies" },
                { id: 20, q: "A firewall is used to:", options: ["Speed up the network", "Monitor and control incoming and outgoing network traffic", "Store network data", "Connect different networks"], answer: 1, difficulty: "easy", topic: "Network Security" }
            ],
            operatingSystems: [
                { id: 1, q: "Which is NOT a core function of an OS?", options: ["Memory Management", "Process Management", "Providing a user interface", "Compiling code"], answer: 3, difficulty: "easy", topic: "OS Fundamentals" },
                { id: 2, q: "What is a process?", options: ["A program in execution", "A file on disk", "A hardware component", "A compiler"], answer: 0, difficulty: "easy", topic: "Processes & Threads" },
                { id: 3, q: "What is the main difference between a process and a thread?", options: ["Threads are heavier than processes", "Processes share memory by default", "Threads of a process share the same memory space", "A process cannot have multiple threads"], answer: 2, difficulty: "medium", topic: "Processes & Threads" },
                { id: 4, q: "Which scheduling algorithm can lead to starvation?", options: ["First-Come, First-Served (FCFS)", "Priority Scheduling", "Round Robin", "All of the above"], answer: 1, difficulty: "medium", topic: "CPU Scheduling" },
                { id: 5, q: "A situation where processes are blocked, each waiting for a resource held by another, is called:", options: ["Livelock", "Deadlock", "Starvation", "Race Condition"], answer: 1, difficulty: "easy", topic: "Concurrency" },
                { id: 6, q: "What is virtual memory?", options: ["A very fast type of RAM", "A technique that allows execution of processes not completely in memory", "A part of the CPU cache", "A cloud storage service"], answer: 1, difficulty: "medium", topic: "Memory Management" },
                { id: 7, q: "A page table is used for:", options: ["Storing process control blocks", "Mapping virtual addresses to physical addresses", "CPU scheduling", "File management"], answer: 1, difficulty: "medium", topic: "Memory Management" },
                { id: 8, q: "What is a semaphore?", options: ["A memory location", "A hardware interrupt", "A synchronization tool", "A file descriptor"], answer: 2, difficulty: "hard", topic: "Concurrency" },
                { id: 9, q: "Which is a non-preemptive scheduling algorithm?", options: ["Round Robin", "Shortest Remaining Time First (SRTF)", "First-Come, First-Served (FCFS)", "Priority Scheduling (Preemptive)"], answer: 2, difficulty: "medium", topic: "CPU Scheduling" },
                { id: 10, q: "The phenomenon of excessive paging is called:", options: ["Paging", "Swapping", "Thrashing", "Fragmentation"], answer: 2, difficulty: "hard", topic: "Memory Management" },
                { id: 11, q: "What is the kernel?", options: ["A command-line interpreter", "The core component of the operating system", "A utility program", "A type of shell"], answer: 1, difficulty: "easy", topic: "OS Fundamentals" },
                { id: 12, q: "Which file system is native to modern Windows?", options: ["ext4", "APFS", "NTFS", "HFS+"], answer: 2, difficulty: "easy", topic: "File Systems" },
                { id: 13, q: "What is a 'context switch'?", options: ["Switching between user mode and kernel mode", "Saving the state of a process and loading another", "Switching between hard drives", "Switching between applications"], answer: 1, difficulty: "medium", topic: "Processes & Threads" },
                { id: 14, q: "The four necessary conditions for deadlock are Mutual Exclusion, Hold and Wait, No Preemption, and...?", options: ["Circular Wait", "Race Condition", "Starvation", "Livelock"], answer: 0, difficulty: "hard", topic: "Concurrency" },
                { id: 15, q: "The Banker's algorithm is used for:", options: ["Deadlock prevention", "Deadlock avoidance", "Deadlock detection", "Memory allocation"], answer: 1, difficulty: "hard", topic: "Concurrency" },
                { id: 16, q: "What is fragmentation?", options: ["Breaking a file into pieces", "A security vulnerability", "Wasted memory space that cannot be allocated", "A type of CPU cache"], answer: 2, difficulty: "medium", topic: "Memory Management" },
                { id: 17, q: "Which scheduling algorithm provides the minimum average waiting time?", options: ["FCFS", "SJF", "Round Robin", "Priority"], answer: 1, difficulty: "medium", topic: "CPU Scheduling" },
                { id: 18, q: "A 'system call' is how a program requests a service from:", options: ["The network", "The user", "The operating system's kernel", "Another program"], answer: 2, difficulty: "easy", topic: "OS Fundamentals" },
                { id: 19, q: "What is a 'race condition'?", options: ["When two processes compete for the CPU", "An error from incorrect scheduling", "When system behavior depends on the sequence of uncontrollable events", "A deadlock situation"], answer: 2, difficulty: "hard", topic: "Concurrency" },
                { id: 20, q: "What does a 'shell' in an OS do?", options: ["Manages memory", "Provides a command-line interface", "Is the core of the OS", "Handles graphics"], answer: 1, difficulty: "easy", topic: "OS Fundamentals" }
            ],
            databases: [
                { id: 1, q: "What does SQL stand for?", options: ["Structured Query Language", "Simple Query Language", "Standardized Query Language", "System Query Language"], answer: 0, difficulty: "easy", topic: "SQL Basics" },
                { id: 2, q: "Which SQL statement is used to extract data?", options: ["GET", "OPEN", "EXTRACT", "SELECT"], answer: 3, difficulty: "easy", topic: "SQL Queries" },
                { id: 3, q: "What is a primary key?", options: ["The first key in a table", "A key that is used to encrypt data", "A unique identifier for a record", "A foreign key from another table"], answer: 2, difficulty: "easy", topic: "Database Concepts" },
                { id: 4, q: "Which JOIN returns all records from the left table and matched records from the right?", options: ["INNER JOIN", "LEFT JOIN", "RIGHT JOIN", "FULL OUTER JOIN"], answer: 1, difficulty: "medium", topic: "SQL Joins" },
                { id: 5, q: "The process of organizing tables to minimize data redundancy is called:", options: ["Indexing", "Normalization", "Querying", "Clustering"], answer: 1, difficulty: "medium", topic: "Normalization" },
                { id: 6, q: "Which normal form deals with removing partial dependencies?", options: ["First Normal Form (1NF)", "Second Normal Form (2NF)", "Third Normal Form (3NF)", "Boyce-Codd Normal Form (BCNF)"], answer: 1, difficulty: "hard", topic: "Normalization" },
                { id: 7, q: "What does the 'A' in ACID properties for transactions stand for?", options: ["Availability", "Atomicity", "Accuracy", "Authentication"], answer: 1, difficulty: "medium", topic: "Transactions" },
                { id: 8, q: "Which SQL clause is used to filter results based on a condition?", options: ["HAVING", "GROUP BY", "WHERE", "ORDER BY"], answer: 2, difficulty: "easy", topic: "SQL Queries" },
                { id: 9, q: "What is the primary purpose of a database index?", options: ["To ensure data integrity", "To speed up data retrieval", "To create table relationships", "To backup data"], answer: 1, difficulty: "medium", topic: "Performance" },
                { id: 10, q: "Which of the following is a popular NoSQL database?", options: ["MySQL", "PostgreSQL", "MongoDB", "Oracle"], answer: 2, difficulty: "easy", topic: "NoSQL" },
                { id: 11, q: "The SQL command to delete an entire table is:", options: ["DELETE TABLE", "REMOVE TABLE", "DROP TABLE", "TRUNCATE TABLE"], answer: 2, difficulty: "medium", topic: "SQL DDL" },
                { id: 12, q: "What is a key difference between DELETE and TRUNCATE?", options: ["DELETE is faster", "TRUNCATE cannot be rolled back", "TRUNCATE doesn't activate triggers", "All of the above"], answer: 3, difficulty: "hard", topic: "SQL DML" },
                { id: 13, q: "A foreign key is used to:", options: ["Uniquely identify a record", "Encrypt data", "Link two tables together", "Create a primary key"], answer: 2, difficulty: "easy", topic: "Database Concepts" },
                { id: 14, q: "Which aggregate function returns the number of rows?", options: ["SUM()", "AVG()", "COUNT()", "MAX()"], answer: 2, difficulty: "easy", topic: "SQL Functions" },
                { id: 15, q: "What type of NoSQL database is Redis?", options: ["Document Store", "Graph Database", "Column-Family Store", "Key-Value Store"], answer: 3, difficulty: "hard", topic: "NoSQL" },
                { id: 16, q: "What does DDL stand for in SQL?", options: ["Data Definition Language", "Data Distribution Language", "Data Deletion Language", "Data Duplication Language"], answer: 0, difficulty: "medium", topic: "SQL Basics" },
                { id: 17, q: "Which clause is used with aggregate functions to group rows?", options: ["WHERE", "HAVING", "GROUP BY", "ORDER BY"], answer: 2, difficulty: "medium", topic: "SQL Queries" },
                { id: 18, q: "Which normal form requires that there are no transitive functional dependencies?", options: ["1NF", "2NF", "3NF", "BCNF"], answer: 2, difficulty: "hard", topic: "Normalization" },
                { id: 19, q: "A view in SQL is a:", options: ["Physical table", "Backup of a table", "Virtual table based on a SQL query", "Snapshot of data"], answer: 2, difficulty: "medium", topic: "Database Concepts" },
                { id: 20, q: "What does 'sharding' refer to in databases?", options: ["Creating an index", "Encrypting data", "Horizontally partitioning data across multiple servers", "Running a complex query"], answer: 2, difficulty: "hard", topic: "Performance" }
            ],
            placementPreparation: [
                { id: 1, q: "A train running at 60 km/hr crosses a pole in 9 seconds. What is the length of the train?", options: ["120 metres", "150 metres", "180 metres", "200 metres"], answer: 1, difficulty: "easy", topic: "Quantitative Aptitude" },
                { id: 2, q: "If 30% of a number is 150, what is the number?", options: ["300", "450", "500", "600"], answer: 2, difficulty: "easy", topic: "Quantitative Aptitude" },
                { id: 3, q: "A can do a work in 15 days and B in 20 days. If they work on it together for 4 days, then the fraction of the work that is left is:", options: ["1/4", "7/15", "8/15", "1/10"], answer: 2, difficulty: "medium", topic: "Quantitative Aptitude" },
                { id: 4, q: "Look at this series: 7, 10, 8, 11, 9, 12, ... What number should come next?", options: ["7", "10", "12", "13"], answer: 1, difficulty: "easy", topic: "Logical Reasoning" },
                { id: 5, q: "Pointing to a photograph of a boy, Suresh said, 'He is the son of the only son of my mother.' How is Suresh related to that boy?", options: ["Brother", "Uncle", "Cousin", "Father"], answer: 3, difficulty: "medium", topic: "Logical Reasoning" },
                { id: 6, q: "Statement: All pens are pencils. All pencils are books. Conclusion: All pens are books.", options: ["True", "False", "Cannot be determined"], answer: 0, difficulty: "medium", topic: "Logical Reasoning" },
                { id: 7, q: "Choose the word which is the exact OPPOSITE of the word: 'EXPAND'", options: ["Condense", "Enlarge", "Extend", "Widen"], answer: 0, difficulty: "easy", topic: "Verbal Ability" },
                { id: 8, q: "Choose the correct synonym for 'MITIGATE'", options: ["Aggravate", "Alleviate", "Intensify", "Increase"], answer: 1, difficulty: "medium", topic: "Verbal Ability" },
                { id: 9, q: "He is ______ to listening to the complaints of the common man.", options: ["accustomed", "addicted", "aware", "used"], answer: 0, difficulty: "medium", topic: "Verbal Ability" },
                { id: 10, q: "You have two empty jars of 5 litres and 3 litres. How do you measure exactly 4 litres of water?", options: ["Fill 5L, pour to 3L, empty 3L, pour remaining 2L to 3L, fill 5L, fill 3L from 5L", "Fill 3L, pour to 5L, fill 3L, pour to 5L", "Impossible", "Fill 5L, empty it"], answer: 0, difficulty: "hard", topic: "Interview Puzzles" },
                { id: 11, q: "Why are manhole covers round?", options: ["Easier to manufacture", "Lighter", "So they can't fall through the hole", "Tradition"], answer: 2, difficulty: "easy", topic: "Interview Puzzles" },
                { id: 12, q: "A man buys an article for Rs. 27.50 and sells it for Rs. 28.60. Find his gain percent.", options: ["3%", "4%", "5%", "6%"], answer: 1, difficulty: "easy", topic: "Quantitative Aptitude"},
                { id: 13, q: "Find the odd one out: 3, 5, 11, 14, 17, 21", options: ["14", "17", "21", "11"], answer: 0, difficulty: "medium", topic: "Logical Reasoning"},
                { id: 14, q: "CUP : LIP :: BIRD : ?", options: ["BUSH", "GRASS", "FOREST", "BEAK"], answer: 3, difficulty: "easy", topic: "Verbal Ability"},
                { id: 15, q: "A clock is started at noon. By 10 minutes past 5, the hour hand has turned through:", options: ["145°", "150°", "155°", "160°"], answer: 2, difficulty: "hard", topic: "Quantitative Aptitude"},
            ]
        };

        const subjects = [
            { key: 'grammar', name: 'Grammar', icon: icons.BookOpen, color: 'var(--green-500)' },
            { key: 'dsa', name: 'DSA', icon: icons.Brain, color: 'var(--purple-500)' },
            { key: 'programming', name: 'Programming', icon: icons.Code, color: 'var(--red-500)' },
            { key: 'computerNetworks', name: 'Networks', icon: icons.Network, color: 'var(--blue-500)' },
            { key: 'operatingSystems', name: 'OS', icon: icons.Cpu, color: 'var(--yellow-500)' },
            { key: 'databases', name: 'Databases', icon: icons.Database, color: 'var(--indigo-500)' },
            { key: 'placementPreparation', name: 'Placement Prep', icon: icons.Briefcase, color: 'var(--cyan-500)' }
        ];

        const PROCESSED_QUESTION_BANK = Object.fromEntries(
            Object.entries(QUESTION_BANK).map(([subject, questions]) => [
                subject,
                questions.map(q => ({ ...q, subject }))
            ])
        );

        // --- APPLICATION STATE ---
        let state = {
            screen: 'login', // 'login', 'signup', 'dashboard', 'topicSelection', 'quiz', 'profile'
            currentUser: null,
            error: '',
            selectedSubject: null,
            quizTitle: '',
            questions: [],
            currentQuestionIndex: 0,
            selectedAnswer: null,
            isQuizComplete: false,
            answers: [],
            isMentorOpen: false,
            mentorContext: { subject: '', topic: ''},
            mentorMessages: [],
        };

        let performanceChart = null; // To hold the chart instance

        // --- RENDER FUNCTIONS ---
        const appRoot = document.getElementById('app-root');
        const mentorModal = document.getElementById('ai-mentor-modal');

        function render() {
            // Clear previous content
            appRoot.innerHTML = '';

            // Render current screen
            switch (state.screen) {
                case 'login':
                    appRoot.innerHTML = renderLoginScreen();
                    break;
                case 'signup':
                    appRoot.innerHTML = renderSignupScreen();
                    break;
                case 'dashboard':
                    appRoot.innerHTML = renderDashboardScreen();
                    // Render chart after main content is in the DOM
                    setTimeout(renderOverallPerformanceChart, 0);
                    break;
                case 'topicSelection':
                    appRoot.innerHTML = renderTopicSelectionScreen();
                    break;
                case 'quiz':
                    appRoot.innerHTML = renderQuizScreen();
                    break;
                case 'profile':
                    appRoot.innerHTML = renderProfileScreen();
                    break;
            }
            
            // Render AI Mentor Modal
            if(state.isMentorOpen) {
                mentorModal.innerHTML = renderAIMentorModal();
                mentorModal.classList.remove('hidden');
                document.getElementById('mentor-input-form').addEventListener('submit', handleMentorSendMessage);
                document.getElementById('close-mentor-btn').addEventListener('click', closeMentor);
                const messagesContainer = document.querySelector('.mentor-messages');
                if(messagesContainer) messagesContainer.scrollTop = messagesContainer.scrollHeight;
            } else {
                mentorModal.innerHTML = '';
                mentorModal.classList.add('hidden');
            }
            
            // After rendering, attach event listeners
            attachEventListeners();
        }
        
        // --- SCREEN TEMPLATES ---

        function renderLoginScreen() {
            return `
                <div id="login-screen" class="screen-container auth-container">
                    <div class="card">
                        <div style="text-align: center;">
                            <div class="icon-wrapper">${icons.Brain}</div>
                            <h1>IntelliLearn AI</h1>
                            <p>Welcome back! Please sign in.</p>
                        </div>
                        <form id="login-form">
                            <div class="form-group">
                                <label class="form-label" for="login-email">Email</label>
                                <input id="login-email" class="form-input" type="email" value="demo@example.com" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="login-password">Password</label>
                                <input id="login-password" class="form-input" type="password" value="demo123" required>
                            </div>
                            ${state.error ? `<div class="error-message">${icons.AlertCircle} ${state.error}</div>` : ''}
                            <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">Login</button>
                        </form>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button id="go-to-signup" class="link">Don't have an account? Sign up</button>
                        </div>
                        <div class="demo-box">
                            <strong>Demo Credentials:</strong><br>
                            Email: demo@example.com | Password: demo123
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSignupScreen() {
            return `
                 <div id="signup-screen" class="screen-container auth-container">
                    <div class="card">
                        <div style="text-align: center;">
                            <div class="icon-wrapper">${icons.Brain}</div>
                            <h1>Create Account</h1>
                            <p>Start your learning journey.</p>
                        </div>
                        <form id="signup-form">
                            <div class="form-group">
                                <label class="form-label" for="signup-name">Full Name</label>
                                <input id="signup-name" class="form-input" type="text" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="signup-email">Email</label>
                                <input id="signup-email" class="form-input" type="email" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="signup-password">Password</label>
                                <input id="signup-password" class="form-input" type="password" required>
                            </div>
                            ${state.error ? `<div class="error-message">${icons.AlertCircle} ${state.error}</div>` : ''}
                            <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">Sign Up</button>
                        </form>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button id="go-to-login" class="link">Already have an account? Login</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderDashboardScreen() {
            const subjectCardsHTML = subjects.map(subject => {
                const progress = getUserProgress(subject.key);
                const accuracy = progress.totalQuestions > 0 ? Math.round((progress.correctAnswers / progress.totalQuestions) * 100) : 0;

                return `
                    <div class="subject-card">
                        <div class="card-header">
                           <span style="color:${subject.color}">${subject.icon}</span>
                           <h2>${subject.name}</h2>
                        </div>
                        <div>
                           <p style="font-size: 0.875rem; color: var(--gray-500); margin: 0 0 0.25rem 0;">Overall Accuracy</p>
                           <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                               <p style="font-size: 1.875rem; font-weight: 700; margin: 0;">${accuracy}%</p>
                           </div>
                           <div class="progress-bar-bg">
                               <div class="progress-bar-fg" style="width: ${accuracy}%;"></div>
                           </div>
                        </div>
                        <button class="btn btn-primary start-btn" data-subject-key="${subject.key}" style="margin-top: 1.5rem;">Start Learning</button>
                    </div>
                `;
            }).join('');
            
            const analysisSectionsHTML = subjects.map(subject => {
                const analysisData = getTopicAnalysis(subject.key);
                if (analysisData.length === 0) return ''; 
                return renderAnalysisSection(subject, analysisData);
            }).join('');

            return `
                <div id="dashboard-screen">
                    <header class="header">
                        <div class="container header-content">
                            <div class="logo">
                                ${icons.Brain}
                                <h1>IntelliLearn</h1>
                            </div>
                            <div class="user-menu">
                                <span>Welcome, ${state.currentUser.name}!</span>
                                <button id="profile-btn">
                                    <img class="profile-img" src="${state.currentUser.photoUrl || 'https://placehold.co/40x40/E2E8F0/4A5568?text=P'}" alt="Profile">
                                </button>
                                <button id="logout-btn">${icons.LogOut}</button>
                            </div>
                        </div>
                    </header>
                    <main class="container" style="padding-top: 2rem; padding-bottom: 2rem;">
                         <div style="margin-bottom: 2rem;">
                            <button id="smart-review-btn" class="btn btn-smart-review" style="padding: 1rem; font-size: 1.125rem;">
                                ${icons.Zap} Start AI Smart Review
                            </button>
                         </div>
                         <h2 style="font-size: 1.875rem; font-weight: 700; margin-bottom: 1.5rem;">Choose a Subject</h2>
                         <div class="subject-grid">
                            ${subjectCardsHTML}
                         </div>

                         <div class="analysis-container">
                            <h3 class="analysis-title">
                                <span style="color: var(--indigo-500)">${icons.TrendingUp}</span>
                                Overall Performance
                            </h3>
                            <div style="position: relative; height: 300px;">
                                <canvas id="performanceChart"></canvas>
                            </div>
                         </div>

                         <div id="analysis-sections-container">
                            ${analysisSectionsHTML}
                         </div>
                    </main>
                </div>
            `;
        }

        function renderAnalysisSection(subject, analysisData) {
            const weakTopics = analysisData.filter(item => item.accuracy < 70);

            const improvementItemsHTML = weakTopics.map(item => `
                <li class="improvement-item">
                    <span>${item.topic} (${item.accuracy}%)</span>
                    <button class="btn ask-mentor-btn" data-subject-key="${subject.key}" data-topic="${item.topic}">Ask AI Mentor</button>
                </li>
            `).join('');

            return `
                <div class="analysis-section">
                    <h3 class="analysis-title">
                        Breakdown: ${subject.name}
                    </h3>
                    ${improvementItemsHTML.length > 0 ? `
                        <h4 style="margin-bottom: 0.75rem; font-weight: 600;">Areas for Improvement:</h4>
                        <ul class="improvement-list">${improvementItemsHTML}</ul>
                    ` : `
                        <p style="background-color: var(--green-50); color: var(--green-800); padding: 1rem; border-radius: 0.5rem;">
                        Excellent work! No specific areas for improvement in this subject right now.
                        </p>
                    `}
                </div>
            `;
        }

        function renderTopicSelectionScreen() {
            const subjectInfo = subjects.find(s => s.key === state.selectedSubject);
            const allTopics = [...new Set(PROCESSED_QUESTION_BANK[state.selectedSubject].map(q => q.topic))];
            
            const topicButtonsHTML = allTopics.map(topic => `
                <button class="btn btn-secondary topic-btn" data-topic="${topic}">${topic}</button>
            `).join('');

            return `
                <div id="topic-selection-screen">
                    <header class="header">
                        <div class="container header-content" style="justify-content: flex-start; gap: 2rem;">
                            <button id="back-to-dashboard" class="btn" style="width: auto; background: none; padding: 0.5rem;">${icons.ArrowLeft} Back</button>
                            <h1 style="font-size: 1.5rem; margin: 0;">${subjectInfo.name}</h1>
                        </div>
                    </header>
                    <main class="container" style="text-align: center; padding-top: 2rem;">
                        <p style="font-size: 1.125rem; color: var(--gray-600); margin-bottom: 2rem;">Select a topic to begin.</p>
                        <div class="subject-grid">
                            <button class="btn btn-primary topic-btn" data-topic="all">
                                ${icons.RefreshCw} Start Mixed Topic Quiz
                            </button>
                            ${topicButtonsHTML}
                        </div>
                    </main>
                </div>
            `;
        }
        
        function renderQuizScreen() {
            if (state.isQuizComplete) {
                const score = state.answers.filter(a => a.correct).length;
                const total = state.questions.length;
                const incorrectAnswersHTML = state.answers
                    .filter(a => !a.correct)
                    .map((answer, index) => {
                        const question = state.questions.find(q => q.id === answer.questionId);
                        return `
                        <div class="review-question">
                            <p style="font-weight: 600;">${question.q}</p>
                            <p style="font-size: 0.8rem; color: var(--gray-600);">Your answer: <b style="color: var(--red-700);">${question.options[answer.userAnswer]}</b></p>
                            <p style="font-size: 0.8rem; color: var(--gray-600);">Correct answer: <b style="color: var(--green-700);">${question.options[question.answer]}</b></p>
                            <button class="btn explain-btn" data-question-id="${question.id}" data-user-answer-index="${answer.userAnswer}">
                                ${icons.Zap} Explain with AI
                            </button>
                        </div>`;
                    }).join('') || `<div style="text-align: center; color: var(--green-700); background-color: var(--green-50); padding: 1rem; border-radius: 0.5rem;">Great job! You answered all questions correctly!</div>`;
                
                return `
                    <div class="screen-container">
                        <div class="card results-card animate-fade-in-up" style="max-width: 48rem;">
                            <div style="text-align: center;">
                                <div class="icon-wrapper">${icons.Trophy}</div>
                                <h1>Quiz Complete!</h1>
                                <p class="score-text">You scored <b>${score}</b> out of <b>${total}</b></p>
                            </div>
                            <div style="margin: 2rem 0;">
                                <h3 style="font-weight: 700;">Questions to Review:</h3>
                                ${incorrectAnswersHTML}
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button id="try-again-btn" class="btn btn-primary">Try Again</button>
                                <button id="back-to-dashboard" class="btn btn-secondary">Dashboard</button>
                            </div>
                        </div>
                    </div>`;
            }

            const q = state.questions[state.currentQuestionIndex];
            const progress = ((state.currentQuestionIndex + 1) / state.questions.length) * 100;
            const optionsHTML = q.options.map((option, index) => `
                <button class="quiz-option-btn ${state.selectedAnswer === index ? 'selected' : ''}" data-index="${index}">
                    ${option}
                    ${state.selectedAnswer === index ? icons.CheckCircle : ''}
                </button>
            `).join('');

            return `
                 <div class="screen-container">
                    <div class="card quiz-card animate-fade-in">
                        <div class="quiz-header">
                            <h2>${state.quizTitle} Quiz</h2>
                            <span>${state.currentQuestionIndex + 1} / ${state.questions.length}</span>
                        </div>
                        <div class="progress-bar-bg" style="margin-bottom: 1.5rem;">
                            <div class="progress-bar-fg" style="width: ${progress}%;"></div>
                        </div>
                        <p class="quiz-question-text">${q.q}</p>
                        <div class="quiz-options">${optionsHTML}</div>
                        <button id="submit-answer-btn" class="btn submit-btn" ${state.selectedAnswer === null ? 'disabled' : ''}>
                           ${state.currentQuestionIndex === state.questions.length - 1 ? 'Finish Quiz' : 'Submit Answer'}
                        </button>
                    </div>
                </div>
            `;
        }

        function renderProfileScreen() {
             return `
                <div id="profile-screen">
                    <header class="header">
                        <div class="container header-content" style="justify-content: flex-start; gap: 2rem;">
                            <button id="back-to-dashboard" class="btn" style="width: auto; background: none; padding: 0.5rem;">${icons.ArrowLeft} Back</button>
                        </div>
                    </header>
                    <main class="container" style="padding: 2rem 1rem; display: flex; justify-content: center;">
                         <div class="card" style="max-width: 42rem;">
                            <form id="profile-form">
                                <div class="profile-header">
                                    <img src="${state.currentUser.photoUrl || 'https://placehold.co/128x128/E2E8F0/4A5568?text=Upload'}" alt="Profile">
                                    <div style="flex-grow: 1; width: 100%;">
                                        <label class="form-label" for="profile-photo">Photo URL</label>
                                        <input id="profile-photo" class="form-input" type="text" value="${state.currentUser.photoUrl || ''}">
                                        <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem;">Enter a URL to your profile picture.</p>
                                    </div>
                                </div>
                                <hr style="margin: 1.5rem 0;">
                                <div class="form-group">
                                    <label class="form-label" for="profile-name">Full Name</label>
                                    <input id="profile-name" class="form-input" type="text" value="${state.currentUser.name}" required>
                                </div>
                                <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem;">
                                    <button type="button" id="cancel-profile" class="btn btn-secondary" style="width: auto;">Cancel</button>
                                    <button type="submit" class="btn btn-primary" style="width: auto;">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </main>
                </div>
            `;
        }

        function renderAIMentorModal() {
            const messagesHTML = state.mentorMessages.map(msg => `
                <div class="message ${msg.role}">
                    ${msg.text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\*/g, '').replace(/\n/g, '<br>')}
                </div>
            `).join('');

            return `
                <div class="mentor-chat-window animate-fade-in-up">
                    <header class="mentor-header">
                        <h2>AI Mentor: <span>${state.mentorContext.topic}</span></h2>
                        <button id="close-mentor-btn">${icons.X}</button>
                    </header>
                    <div class="mentor-messages">${messagesHTML}</div>
                    <form id="mentor-input-form" class="mentor-input-form">
                        <input type="text" id="mentor-input" class="form-input" placeholder="Ask a follow-up question..." autocomplete="off" required>
                        <button type="submit" class="btn btn-primary" style="width: auto;">${icons.Send}</button>
                    </form>
                </div>
            `;
        }


        // --- EVENT HANDLERS & LOGIC ---

        function attachEventListeners() {
            // Screen navigation
            const loginForm = document.getElementById('login-form');
            if (loginForm) loginForm.addEventListener('submit', handleLogin);

            const signupForm = document.getElementById('signup-form');
            if (signupForm) signupForm.addEventListener('submit', handleSignup);
            
            const goToSignupBtn = document.getElementById('go-to-signup');
            if(goToSignupBtn) goToSignupBtn.addEventListener('click', () => updateState({ screen: 'signup', error: '' }));

            const goToLoginBtn = document.getElementById('go-to-login');
            if(goToLoginBtn) goToLoginBtn.addEventListener('click', () => updateState({ screen: 'login', error: '' }));

            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) logoutBtn.addEventListener('click', () => updateState({ screen: 'login', currentUser: null }));
            
            const profileBtn = document.getElementById('profile-btn');
            if (profileBtn) profileBtn.addEventListener('click', () => updateState({ screen: 'profile' }));
            
            const backToDashboardBtn = document.getElementById('back-to-dashboard');
            if(backToDashboardBtn) backToDashboardBtn.addEventListener('click', () => updateState({ screen: 'dashboard'}));

            const smartReviewBtn = document.getElementById('smart-review-btn');
            if(smartReviewBtn) smartReviewBtn.addEventListener('click', startSmartReviewQuiz);

            // Profile
            const profileForm = document.getElementById('profile-form');
            if (profileForm) profileForm.addEventListener('submit', handleProfileUpdate);
            
            const cancelProfileBtn = document.getElementById('cancel-profile');
            if(cancelProfileBtn) cancelProfileBtn.addEventListener('click', () => updateState({ screen: 'dashboard'}));

            // Quiz Start
            document.querySelectorAll('.start-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const subjectKey = e.currentTarget.dataset.subjectKey;
                    updateState({ screen: 'topicSelection', selectedSubject: subjectKey });
                });
            });
            
            document.querySelectorAll('.topic-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const topic = e.currentTarget.dataset.topic;
                    startQuiz({ subjectKey: state.selectedSubject, topic: topic === 'all' ? null : topic });
                });
            });

            // Quiz Interaction
            document.querySelectorAll('.quiz-option-btn').forEach(button => {
                button.addEventListener('click', e => {
                    const index = parseInt(e.currentTarget.dataset.index, 10);
                    updateState({ selectedAnswer: index });
                });
            });
            
            const submitAnswerBtn = document.getElementById('submit-answer-btn');
            if (submitAnswerBtn) submitAnswerBtn.addEventListener('click', submitAnswer);
            
            const tryAgainBtn = document.getElementById('try-again-btn');
            if(tryAgainBtn) tryAgainBtn.addEventListener('click', () => {
                startQuiz({ subjectKey: state.selectedSubject, topic: state.quizTitle === subjects.find(s=>s.key === state.selectedSubject)?.name ? null : state.quizTitle });
            });
            
            // AI Mentor
            document.querySelectorAll('.ask-mentor-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const subjectKey = e.currentTarget.dataset.subjectKey;
                    const topic = e.currentTarget.dataset.topic;
                    openMentor({ subjectKey, topic });
                });
            });
            
            document.querySelectorAll('.explain-btn').forEach(button => {
                button.addEventListener('click', e => {
                    const questionId = e.currentTarget.dataset.questionId;
                    const userAnswerIndex = parseInt(e.currentTarget.dataset.userAnswerIndex, 10);
                    const question = state.questions.find(q => q.id == questionId);
                    handleExplainQuestion(question, userAnswerIndex);
                });
            });
        }

        function updateState(newState) {
            state = { ...state, ...newState };
            render();
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const user = DB.users.find(u => u.email === email && u.password === password);
            if (user) {
                updateState({ currentUser: user, screen: 'dashboard', error: '' });
            } else {
                updateState({ error: 'Invalid credentials' });
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;

            if (DB.users.find(u => u.email === email)) {
                return updateState({ error: 'Email already exists' });
            }
            const newUser = { id: DB.users.length + 1, name, email, password, photoUrl: '' };
            DB.users.push(newUser);
            updateState({ currentUser: newUser, screen: 'dashboard', error: '' });
        }

        function handleProfileUpdate(e) {
            e.preventDefault();
            const newName = document.getElementById('profile-name').value;
            const newPhotoUrl = document.getElementById('profile-photo').value;

            const userIndex = DB.users.findIndex(u => u.id === state.currentUser.id);
            if (userIndex !== -1) {
                const updatedUser = { ...state.currentUser, name: newName, photoUrl: newPhotoUrl };
                DB.users[userIndex] = updatedUser;
                updateState({ currentUser: updatedUser, screen: 'dashboard' });
            }
        }
        
        function startQuiz({ subjectKey, topic = null, questions = null, title = null }) {
            let questionsToUse = questions;
            if (!questionsToUse) {
                questionsToUse = generateQuestionSet(subjectKey, topic);
            }

            if (questionsToUse.length === 0) {
                alert('No questions available for this topic.');
                return;
            }
            const subjectName = subjects.find(s => s.key === subjectKey)?.name;
            updateState({
                screen: 'quiz',
                questions: questionsToUse,
                quizTitle: title || topic || subjectName,
                selectedSubject: subjectKey,
                currentQuestionIndex: 0,
                selectedAnswer: null,
                isQuizComplete: false,
                answers: [],
            });
        }
        
        function submitAnswer() {
            if (state.selectedAnswer === null) return;
            const currentQ = state.questions[state.currentQuestionIndex];
            const correct = currentQ.answer === state.selectedAnswer;
            
            const newAnswer = {
                questionId: currentQ.id,
                correct: correct,
                userAnswer: state.selectedAnswer
            };
            
            const attemptExists = DB.attempts.some(a => a.userId === state.currentUser.id && a.questionId === currentQ.id);
            if(!attemptExists) { // Only add to attempts if it's a new question being answered
                DB.attempts.push({
                    userId: state.currentUser.id,
                    subject: currentQ.subject,
                    topic: currentQ.topic,
                    ...newAnswer,
                });
            }


            const updatedAnswers = [...state.answers, newAnswer];

            if (state.currentQuestionIndex < state.questions.length - 1) {
                updateState({
                    currentQuestionIndex: state.currentQuestionIndex + 1,
                    selectedAnswer: null,
                    answers: updatedAnswers
                });
            } else {
                updateProgress(updatedAnswers);
                updateState({
                    isQuizComplete: true,
                    answers: updatedAnswers
                });
            }
        }
        
        // --- AI MENTOR & SMART REVIEW LOGIC ---
        async function openMentor({ subjectKey, topic, initialPrompt=null }) {
            const subjectName = subjects.find(s => s.key === subjectKey)?.name || "General";
            if (!initialPrompt) {
                 initialPrompt = `Please explain the topic "${topic}" in the subject "${subjectName}". I'm finding it difficult. Explain it simply and provide a clear example.`;
            }
            const userMessageText = initialPrompt.substring(0, 50) + '...'; // a short version for the UI
            
            const initialMessages = [
                { role: 'user', text: userMessageText },
                { role: 'ai', text: 'Thinking...' }
            ];

            updateState({
                isMentorOpen: true,
                mentorContext: { subject: subjectName, topic },
                mentorMessages: initialMessages
            });
            
            const aiResponse = await callGeminiAPI(initialPrompt);
            const updatedMessages = [
                 { role: 'user', text: userMessageText },
                 { role: 'ai', text: aiResponse }
            ];
            updateState({ mentorMessages: updatedMessages });
        }

        function closeMentor() {
            updateState({ isMentorOpen: false, mentorMessages: [], mentorContext: {} });
        }
        
        async function handleMentorSendMessage(e) {
            e.preventDefault();
            const input = document.getElementById('mentor-input');
            const userInput = input.value.trim();
            if(!userInput) return;
            
            const currentMessages = [...state.mentorMessages, { role: 'user', text: userInput }, { role: 'ai', text: 'Thinking...'}];
            updateState({ mentorMessages: currentMessages });
            input.value = '';

            const prompt = `The user is asking a follow-up question about "${state.mentorContext.topic}". Their question is: "${userInput}". Please provide a helpful and concise answer.`;
            const aiResponse = await callGeminiAPI(prompt);
            
            const finalMessages = [...state.mentorMessages.slice(0, -1), { role: 'user', text: userInput }, { role: 'ai', text: aiResponse }];
            updateState({ mentorMessages: finalMessages });
        }
        
        async function handleExplainQuestion(question, userAnswerIndex) {
            const subjectKey = question.subject;
            const topic = question.topic;
            const prompt = `A student was asked the question: "${question.q}". The correct answer is "${question.options[question.answer]}". They incorrectly answered "${question.options[userAnswerIndex]}". Please explain clearly why the correct answer is right and why their choice was wrong.`;
            openMentor({subjectKey, topic, initialPrompt: prompt });
        }

        async function callGeminiAPI(prompt) {
             if (!GEMINI_API_KEY || GEMINI_API_KEY === "YOUR_API_KEY_HERE") {
                return "AI Mentor is offline. Please add your Gemini API key to the script to enable this feature.";
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't generate a response.";
            } catch (error) {
                console.error('Error fetching from Gemini API:', error);
                return 'Sorry, I encountered an error. Please check your connection or API key and try again.';
            }
        }

        function startSmartReviewQuiz() {
            const allWeakTopics = subjects.flatMap(subject => {
                return getTopicAnalysis(subject.key)
                    .filter(topic => topic.accuracy < 70)
                    .map(topic => ({ ...topic, subjectKey: subject.key }));
            }).sort((a,b) => a.accuracy - b.accuracy);

            if (allWeakTopics.length < 2) {
                alert("You need to complete more quizzes to identify weak areas for a Smart Review!");
                return;
            }

            let smartQuestions = [];
            allWeakTopics.slice(0, 5).forEach(t => { // Focus on top 5 weakest topics
                const potentialQuestions = PROCESSED_QUESTION_BANK[t.subjectKey].filter(q => q.topic === t.topic);
                if (potentialQuestions.length > 0) {
                    smartQuestions.push(...potentialQuestions.sort(() => 0.5 - Math.random()).slice(0, 2)); // Add up to 2 random questions
                }
            });

            const finalQuestions = smartQuestions.sort(() => 0.5 - Math.random()).slice(0, 10);
            
            if (finalQuestions.length < 5) {
                alert("Not enough questions available in your weak topics to generate a review. Keep practicing!");
                return;
            }
            
            startQuiz({ subjectKey: finalQuestions[0].subject, questions: finalQuestions, title: 'AI Smart Review' });
        }
        
        // --- HELPER & ANALYSIS FUNCTIONS ---
        function getUserProgress(subjectKey) {
            if (!state.currentUser) return { totalQuestions: 0, correctAnswers: 0 };
            const progress = DB.progress.find(p => p.userId === state.currentUser.id && p.subject === subjectKey);
            return progress || { totalQuestions: 0, correctAnswers: 0 };
        }

        function getTopicAnalysis(subjectKey) {
            if (!state.currentUser) return [];
            const attempts = DB.attempts.filter(a => a.userId === state.currentUser.id && a.subject === subjectKey);
            if (attempts.length === 0) return [];
            
            const topicStats = {};
            attempts.forEach(a => {
                if (!topicStats[a.topic]) topicStats[a.topic] = { correct: 0, total: 0 };
                topicStats[a.topic].total++;
                if (a.correct) topicStats[a.topic].correct++;
            });

            return Object.keys(topicStats).map(topic => ({
                topic,
                accuracy: Math.round((topicStats[topic].correct / topicStats[topic].total) * 100),
                attempts: topicStats[topic].total
            })).sort((a, b) => a.accuracy - b.accuracy);
        }
        
        function updateProgress(finalAnswers) {
             const scoreBySubject = finalAnswers.reduce((acc, answer) => {
                const question = state.questions.find(q => q.id === answer.questionId);
                const subject = question.subject;
                if (!acc[subject]) acc[subject] = { score: 0, count: 0 };
                if (answer.correct) acc[subject].score++;
                acc[subject].count++;
                return acc;
            }, {});

            Object.entries(scoreBySubject).forEach(([subject, data]) => {
                let existing = DB.progress.find(p => p.userId === state.currentUser.id && p.subject === subject);
                if (existing) {
                    existing.totalQuestions += data.count;
                    existing.correctAnswers += data.score;
                } else {
                    DB.progress.push({
                        userId: state.currentUser.id, subject, totalQuestions: data.count,
                        correctAnswers: data.score
                    });
                }
            });
        }
        
        function generateQuestionSet(subject, topic = null) {
            let sourceQuestions = PROCESSED_QUESTION_BANK[subject];
            if (topic) {
                sourceQuestions = sourceQuestions.filter(q => q.topic === topic);
            }
            return sourceQuestions.sort(() => 0.5 - Math.random()).slice(0, 10);
        }

        function renderOverallPerformanceChart() {
            const ctx = document.getElementById('performanceChart');
            if (!ctx) return;

            const labels = [];
            const data = [];
            const backgroundColors = [];

            subjects.forEach(subject => {
                const progress = getUserProgress(subject.key);
                if (progress.totalQuestions > 0) {
                    labels.push(subject.name);
                    const accuracy = Math.round((progress.correctAnswers / progress.totalQuestions) * 100);
                    data.push(accuracy);
                    backgroundColors.push(subject.color.replace(')', ', 0.7)').replace('rgb', 'rgba'));
                }
            });
            
            if (performanceChart) {
                performanceChart.destroy();
            }

            if (data.length === 0) {
                ctx.parentElement.innerHTML = '<p style="text-align:center; color: var(--gray-500);">Complete some quizzes to see your performance chart!</p>';
                return;
            }

            performanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Overall Accuracy (%)',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: backgroundColors.map(color => color.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        y: { grid: { display: false } }
                    },
                    plugins: { legend: { display: false } },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // --- INITIALIZATION ---
        function init() {
            // Create a demo user if none exist
            if (DB.users.length === 0) {
                DB.users.push({
                    id: 1,
                    name: 'Demo User',
                    email: 'demo@example.com',
                    password: 'demo123',
                    photoUrl: 'https://placehold.co/100x100/E2E8F0/4A5568?text=DU',
                });
            }
            render();
        }

        // Start the app
        init();

    </script>
</body>
</html>